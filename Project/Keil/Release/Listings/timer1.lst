C51 COMPILER V9.60.7.0   TIMER1                                                            08/11/2025 14:25:48 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE TIMER1
OBJECT MODULE PLACED IN .\Release\Objects\timer1.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE ..\..\HardWare\timer1.c LARGE OPTIMIZE(8,SPEED) BROWSE INTVECTOR(0X000C)
                    - INCDIR(..\..\Libraries\Include;..\..\User;..\..\HardWare) INTERVAL(3) DEBUG OBJECTEXTEND PRINT(.\Release\Listings\timer
                    -1.lst) OBJECT(.\Release\Objects\timer1.obj)

line level    source

   1          #include "timer1.h"
   2          
   3          // pwmé…ç½®ï¼Œé»˜è®¤ä¸ºä½Žé¢‘ï¼Œå›ºå®šå ç©ºæ¯”
   4          void timer1_pwm_config(void)
   5          {
   6   1          //  é…ç½® P26 ä¸º PWM è¾“å‡ºç«¯å£
   7   1          P2_MD1 &= ~GPIO_P26_MODE_SEL(0x3);
   8   1          P2_MD1 |= GPIO_P26_MODE_SEL(0x1); // è¾“å‡ºæ¨¡å¼
   9   1          FOUT_S26 = GPIO_FOUT_TMR1_PWMOUT;
  10   1      
  11   1          TMR_ALLCON = TMR1_CNT_CLR(0x1);                                       // æ¸…é™¤è®¡æ•°å€¼
  12   1          TMR1_PRH = TMR_PERIOD_VAL_H((TIMER1_LOW_FEQ_PEROID_VAL >> 8) & 0xFF); // å‘¨æœŸå€¼
  13   1          TMR1_PRL = TMR_PERIOD_VAL_L((TIMER1_LOW_FEQ_PEROID_VAL >> 0) & 0xFF);
  14   1          TMR1_PWMH = TMR_PWM_VAL_H((((u32)TIMER1_LOW_FEQ_PEROID_VAL * 0 / 100) >> 8) & 0xFF); // å ç©ºæ¯”è®¾ç½
             -®å€¼
  15   1          TMR1_PWML = TMR_PWM_VAL_L((((u32)TIMER1_LOW_FEQ_PEROID_VAL * 0 / 100) >> 0) & 0xFF);
  16   1          TMR1_CONH = TMR_PRD_PND(0x1) | TMR_PRD_IRQ_EN(0x1);  // ä½¿èƒ½è®¡æ•°ä¸­æ–­
  17   1          TMR1_CONL = TMR_SOURCE_SEL(0x7) | TMR_MODE_SEL(0x2); // é€‰æ‹©ç³»ç»Ÿæ—¶é’Ÿï¼Œæ—¶é’Ÿæºä¸åˆ†é¢‘ï¼ŒPWMæ
             -¨¡å¼
  18   1      }
  19          
  20          // å°†pwmè®¾ç½®ä¸ºé«˜é¢‘çŽ‡ã€0%å ç©ºæ¯”
  21          void timer1_set_pwm_high_feq(void)
  22          {
  23   1          FOUT_S26 = GPIO_FOUT_TMR1_PWMOUT;
  24   1      
  25   1          // 104KHz
  26   1          TMR_ALLCON = TMR1_CNT_CLR(0x1);                                        // æ¸…é™¤è®¡æ•°å€¼
  27   1          TMR1_PRH = TMR_PERIOD_VAL_H((TIMER1_HIGH_FEQ_PEROID_VAL >> 8) & 0xFF); // å‘¨æœŸå€¼
  28   1          TMR1_PRL = TMR_PERIOD_VAL_L((TIMER1_HIGH_FEQ_PEROID_VAL >> 0) & 0xFF);
  29   1          TMR1_PWMH = TMR_PWM_VAL_H((((u32)TIMER1_HIGH_FEQ_PEROID_VAL * 0 / 100) >> 8) & 0xFF); // å ç©ºæ¯”è®¾ç
             -½®å€¼
  30   1          TMR1_PWML = TMR_PWM_VAL_L((((u32)TIMER1_HIGH_FEQ_PEROID_VAL * 0 / 100) >> 0) & 0xFF);
  31   1          TMR1_CONH = TMR_PRD_PND(0x1) | TMR_PRD_IRQ_EN(0x1);  // ä½¿èƒ½è®¡æ•°ä¸­æ–­
  32   1          TMR1_CONL = TMR_SOURCE_SEL(0x7) | TMR_MODE_SEL(0x2); // é€‰æ‹©ç³»ç»Ÿæ—¶é’Ÿï¼Œä¸åˆ†é¢‘ï¼ŒPWMæ¨¡å¼
  33   1      }
  34          
  35          // å°†pwmè®¾ç½®ä¸ºä½Žé¢‘çŽ‡ï¼Œå›ºå®šå ç©ºæ¯”
  36          void timer1_set_pwm_low_feq(void)
  37          {
  38   1          FOUT_S26 = GPIO_FOUT_TMR1_PWMOUT;
  39   1      
  40   1          TMR_ALLCON = TMR1_CNT_CLR(0x1);                                       // æ¸…é™¤è®¡æ•°å€¼
  41   1          TMR1_PRH = TMR_PERIOD_VAL_H((TIMER1_LOW_FEQ_PEROID_VAL >> 8) & 0xFF); // å‘¨æœŸå€¼
  42   1          TMR1_PRL = TMR_PERIOD_VAL_L((TIMER1_LOW_FEQ_PEROID_VAL >> 0) & 0xFF);
  43   1          TMR1_PWMH = TMR_PWM_VAL_H((((u32)TIMER1_LOW_FEQ_PEROID_VAL * 18 / 100) >> 8) & 0xFF); // å ç©ºæ¯”è®¾ç
             -½®å€¼
  44   1          TMR1_PWML = TMR_PWM_VAL_L((((u32)TIMER1_LOW_FEQ_PEROID_VAL * 18 / 100) >> 0) & 0xFF);
  45   1          TMR1_CONH = TMR_PRD_PND(0x1) | TMR_PRD_IRQ_EN(0x1);  // ä½¿èƒ½è®¡æ•°ä¸­æ–­
  46   1          TMR1_CONL = TMR_SOURCE_SEL(0x7) | TMR_MODE_SEL(0x2); // é€‰æ‹©ç³»ç»Ÿæ—¶é’Ÿï¼Œæ—¶é’Ÿæº1åˆ†é¢‘ï¼ŒPWMæ¨¡
             -å¼
  47   1      }
  48          
C51 COMPILER V9.60.7.0   TIMER1                                                            08/11/2025 14:25:48 PAGE 2   

  49          void timer1_set_pwm_duty(u8 duty)
  50          {
  51   1          TMR1_PWMH = (duty >> 8) & 0xFF;
  52   1          TMR1_PWML = duty & 0xFF;
  53   1      }
  54          
  55          void timer1_pwm_enable(void)
  56          {
  57   1          FOUT_S26 = GPIO_FOUT_TMR1_PWMOUT;
  58   1          TMR1_CONL |= (0x02 << 0); // PWMæ¨¡å¼
  59   1      }
  60          
  61          // å…³é—­pwmï¼Œå¼•è„šè¾“å‡ºä½Žç”µå¹³
  62          void timer1_pwm_disable(void)
  63          {
  64   1          TMR1_CONL &= ~(0x03 << 0);    // ä¸ä½¿èƒ½å®šæ—¶å™¨è®¡æ•°
  65   1          FOUT_S26 = GPIO_FOUT_AF_FUNC; // æ•°å­—å¤ç”¨åŠŸèƒ½è¾“å‡º
  66   1          P26 = 0;
  67   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    150    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
