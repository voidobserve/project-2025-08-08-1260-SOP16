C51 COMPILER V9.60.7.0   IR_HANDLE                                                         08/11/2025 14:25:49 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE IR_HANDLE
OBJECT MODULE PLACED IN .\Release\Objects\ir_handle.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE ..\..\User\ir_handle.c LARGE OPTIMIZE(8,SPEED) BROWSE INTVECTOR(0X000C) 
                    -INCDIR(..\..\Libraries\Include;..\..\User;..\..\HardWare) INTERVAL(3) DEBUG OBJECTEXTEND PRINT(.\Release\Listings\ir_han
                    -dle.lst) OBJECT(.\Release\Objects\ir_handle.obj)

line level    source

   1          #include "ir_handle.h"
   2          #include "user_config.h"
   3          
   4          void ir_handle(void)
   5          {
   6   1          static u8 last_ir_data = 0; // è®°å½•ä¸Šä¸€æ¬¡æ”¶åˆ°çš„é”®å€¼ï¼Œåœ¨é•¿æŒ‰æ—¶ä½¿ç”¨
   7   1      
   8   1          if (cur_charge_phase != CUR_CHARGE_PHASE_NONE)
   9   1          {
  10   2              // å¦‚æœå½“å‰æ­£åœ¨å……ç”µï¼Œç›´æ¥è¿”å›
  11   2              flag_is_recved_data = 0;
  12   2              flag_is_recv_ir_repeat_code = 0;
  13   2              last_ir_data = 0;
  14   2              return;
  15   2          }
  16   1      
  17   1          if (flag_is_recved_data)
  18   1          {
  19   2              flag_is_recved_data = 0;
  20   2      
  21   2              last_ir_data = ir_data;
  22   2      
  23   2              switch (ir_data)
  24   2              {
  25   3                  // =================================================================
  26   3                  // å¤§æ‘‡æ§å™¨çš„çº¢è‰²æŒ‰é”®ï¼Œå°é¥æ§å™¨çš„ç»¿è‰²æŒ‰é”®                             //
  27   3                  // =================================================================
  28   3              case IR_KEY_RED:
  29   3      
  30   3                  if (flag_is_in_setting_mode)
  31   3                  {
  32   4                      // æ­£å¤„äºè®¾ç½®æ¨¡å¼ï¼Œä¸å“åº”
  33   4                      return;
  34   4                  }
  35   3      
  36   3                  led_status_clear();
  37   3                  // led_all_off();                         // å…³é—­æ‰€æœ‰led
  38   3                  // flag_led_struction_mode_exit_times_come = 0;
  39   3                  // led_struction_mode_exit_times_cnt = 0; // æ¸…ç©ºledæŒ‡ç¤ºæ¨¡å¼é€€å‡ºæ—¶é—´
  40   3      
  41   3                  flag_is_in_struction_mode = 1; // æ ‡å¿—ä½ç½®ä¸€ï¼Œä¸€æ®µæ—¶é—´åé€€å‡º
  42   3      
  43   3                  if (CUR_LED_MODE_OFF == cur_led_mode)
  44   3                  {
  45   4                      // å¦‚æœæ˜¯ä»å…³ç¯è¿›å…¥åˆ°ledæŒ‡ç¤ºæ¨¡å¼
  46   4                      flag_is_led_off_enable = 1; // è¯¥æ ‡å¿—ä½ç½®ä¸€ï¼Œå¦‚æœæŒ‡ç¤ºæ¨¡å¼é€€å‡ºï¼Œled_modeå˜
             -ä¸ºled_off
  47   4                  }
  48   3      
  49   3                  if (cur_led_mode < CUR_LED_MODE_IN_INSTRUCTION_MODE) // å¦‚æœä¸å¤„äºæŒ‡ç¤ºæ¨¡å¼
  50   3                  {
  51   4                      cur_led_mode = CUR_LED_MODE_BAT_INDICATIOR_IN_INSTRUCTION_MODE; // æŒ‡ç¤ºæ¨¡å¼ å­æ¨¡å¼ 
             -ç”µæ± ç”µé‡æŒ‡ç¤º
C51 COMPILER V9.60.7.0   IR_HANDLE                                                         08/11/2025 14:25:49 PAGE 2   

  52   4                  }
  53   3                  else if (CUR_LED_MODE_BAT_INDICATOR == cur_led_mode)
  54   3                  {
  55   4                      // ç”µæ± ç”µé‡æŒ‡ç¤ºæ¨¡å¼ï¼Œå˜ä¸º æŒ‡ç¤ºæ¨¡å¼ - å­æ¨¡å¼ åˆå§‹æ”¾ç”µæ¡£ä½æŒ‡ç¤º
  56   4                      cur_led_mode = CUR_LED_MODE_INITIAL_DISCHARGE_GEAR_IN_INSTRUCTION_MODE;
  57   4                  }
  58   3                  else // å¦‚æœå¤„äºæŒ‡ç¤ºæ¨¡å¼
  59   3                  {
  60   4                      cur_led_mode++;
  61   4                      if (cur_led_mode > CUR_LED_MODE_DISCHARGE_RATE_IN_INSTRUCTION_MODE)
  62   4                      {
  63   5                          cur_led_mode = CUR_LED_MODE_BAT_INDICATIOR_IN_INSTRUCTION_MODE;
  64   5                      }
  65   4                  }
  66   3      
  67   3                  flag_is_adjust_light_slowly = 0; // å…³é—­ç¼“æ…¢è°ƒèŠ‚ä¸»ç¯å…‰çš„æ“ä½œ
  68   3      
  69   3                  break;
  70   3      
  71   3                  // =================================================================
  72   3                  // æ•°å­—1                                                           //
  73   3                  // =================================================================
  74   3              case IR_KEY_NUM_1:
  75   3      
  76   3                  set_led_mode_status(CUR_LED_MODE_INITIAL_DISCHARGE_GEAR_IN_SETTING_MODE, 1);
  77   3      
  78   3                  flag_is_adjust_light_slowly = 0; // å…³é—­ç¼“æ…¢è°ƒèŠ‚ä¸»ç¯å…‰çš„æ“ä½œ
  79   3      
  80   3                  break;
  81   3      
  82   3                  // =================================================================
  83   3                  // äº®åº¦å‡ï¼Œä¹Ÿæ˜¯å°é¥æ§å™¨çš„æ•°å­—2                                      //
  84   3                  // =================================================================
  85   3              case IR_KEY_BRIGHTNESS_SUB_OR_NUM_2:
  86   3      
  87   3                  flag_is_adjust_light_slowly = 0; // å…³é—­ç¼“æ…¢è°ƒèŠ‚ä¸»ç¯å…‰çš„æ“ä½œ
  88   3      
  89   3                  set_led_mode_status(CUR_LED_MODE_INITIAL_DISCHARGE_GEAR_IN_SETTING_MODE, 2);
  90   3      
  91   3                  // å¦‚æœä¸åœ¨è®¾ç½®æ¨¡å¼ï¼Œæ‰è°ƒèŠ‚äº®åº¦ï¼š
  92   3                  if (0 == flag_is_in_setting_mode)
  93   3                  {
  94   4                      // æŸ¥è¡¨ï¼Œæ‰¾åˆ°å½“å‰äº®åº¦å¯¹åº”è¡¨æ ¼ä¸­çš„ä½ç½®
  95   4                      u8 i;
  96   4                      for (i = 0; i < (u8)(ARRAY_SIZE(light_pwm_sub_table) - 1); i++)
  97   4                      {
  98   5                          if (cur_light_pwm_duty_val > light_pwm_sub_table[i])
  99   5                          {
 100   6                              break;
 101   6                          }
 102   5                      }
 103   4      
 104   4                      cur_light_pwm_duty_val = light_pwm_sub_table[i];
 105   4                      LIGHT_SET_PWM_DUTY(cur_light_pwm_duty_val); // è¿™ä¸ªæ“ä½œåº”è¯¥å¯ä»¥ç»Ÿä¸€æ”¾åˆ°ä¸»å‡½æ
             -•°ä¸­æ¥æ›´æ–°
 106   4                  }
 107   3      
 108   3                  // printf("light pwm sub\n");
 109   3      
 110   3                  break;
 111   3      
 112   3                  // =================================================================
C51 COMPILER V9.60.7.0   IR_HANDLE                                                         08/11/2025 14:25:49 PAGE 3   

 113   3                  // 3Hï¼Œä¹Ÿæ˜¯å°é¥æ§å™¨çš„æ•°å­—3                                          //
 114   3                  // =================================================================
 115   3              case IR_KEY_3H_OR_NUM_3:
 116   3      
 117   3                  flag_is_adjust_light_slowly = 0; // å…³é—­ç¼“æ…¢è°ƒèŠ‚ä¸»ç¯å…‰çš„æ“ä½œ
 118   3                  set_led_mode_status(CUR_LED_MODE_INITIAL_DISCHARGE_GEAR_IN_SETTING_MODE, 3);
 119   3      
 120   3                  // å¦‚æœä¸åœ¨è®¾ç½®æ¨¡å¼ å¹¶ä¸” ä¸åœ¨ æŒ‡ç¤ºæ¨¡å¼ï¼Œæ‰è°ƒèŠ‚
 121   3                  // if (0 == flag_is_in_setting_mode && 0 == flag_is_in_struction_mode)
 122   3                  if (0 == flag_is_in_setting_mode &&   /* ä¸åœ¨è®¾ç½®æ¨¡å¼ */
 123   3                      0 == flag_is_in_struction_mode && /* ä¸åœ¨æŒ‡ç¤ºæ¨¡å¼ */
 124   3                      CUR_LED_MODE_OFF != cur_led_mode) /* æœªå…³æœº */
 125   3                  {
 126   4                      // è®¾ç½®æœªå½“å‰åˆå§‹æŒ¡ä½å¯¹åº”çš„äº®åº¦ï¼š
 127   4                      cur_light_pwm_duty_val = light_pwm_duty_init_val_table[cur_initial_discharge_gear - 1];
 128   4                      // light_auto_shutdown_time_cnt = (u32)3 * 60 * 60 * 1000; // 3 å°æ—¶
 129   4                      light_auto_shutdown_time_cnt = (u32)3 * 1000; // 3 sï¼Œæµ‹è¯•æ—¶ä½¿ç”¨
 130   4                      flag_is_auto_shutdown_enable = 1;
 131   4      
 132   4                      light_blink(3);
 133   4                      // printf("3H press\n");
 134   4                  }
 135   3      
 136   3                  break;
 137   3      
 138   3                  // =================================================================
 139   3                  // äº®åº¦åŠ ï¼Œä¹Ÿæ˜¯å°é¥æ§å™¨çš„æ•°å­—4                                      //
 140   3                  // =================================================================
 141   3              case IR_KEY_BRIGHTNESS_ADD_OR_NUM_4:
 142   3      
 143   3                  set_led_mode_status(CUR_LED_MODE_INITIAL_DISCHARGE_GEAR_IN_SETTING_MODE, 4);
 144   3      
 145   3                  // å¦‚æœä¸åœ¨è®¾ç½®æ¨¡å¼ï¼Œæ‰è°ƒèŠ‚äº®åº¦ï¼š
 146   3                  if (0 == flag_is_in_setting_mode)
 147   3                  {
 148   4                      // æŸ¥è¡¨ï¼Œæ‰¾åˆ°å½“å‰äº®åº¦å¯¹åº”è¡¨æ ¼ä¸­çš„ä½ç½®
 149   4                      u8 i;
 150   4                      for (i = 0; i < ARRAY_SIZE(light_pwm_add_table) - 1; i++)
 151   4                      {
 152   5                          if (cur_light_pwm_duty_val < light_pwm_add_table[i])
 153   5                          {
 154   6                              break;
 155   6                          }
 156   5                      }
 157   4      
 158   4                      // äº®åº¦å¢åŠ æ—¶ï¼Œä¸èƒ½è¶…è¿‡å½“å‰çš„åˆå§‹æŒ¡ä½
 159   4                      if (light_pwm_add_table[i] > light_pwm_duty_init_val_table[cur_initial_discharge_gear - 1]
             -)
 160   4                      {
 161   5                          cur_light_pwm_duty_val = light_pwm_duty_init_val_table[cur_initial_discharge_gear - 1]
             -;
 162   5                      }
 163   4                      else
 164   4                      {
 165   5                          cur_light_pwm_duty_val = light_pwm_add_table[i];
 166   5                      }
 167   4      
 168   4                      flag_is_adjust_light_slowly = 0;            // å…³é—­ç¼“æ…¢è°ƒèŠ‚ä¸»ç¯å…‰çš„æ“ä½œ
 169   4                      LIGHT_SET_PWM_DUTY(cur_light_pwm_duty_val); // è¿™ä¸ªæ“ä½œåº”è¯¥å¯ä»¥ç»Ÿä¸€æ”¾åˆ°ä¸»å‡½æ
             -•°ä¸­æ¥æ›´æ–°
 170   4                  }
 171   3      
C51 COMPILER V9.60.7.0   IR_HANDLE                                                         08/11/2025 14:25:49 PAGE 4   

 172   3                  break;
 173   3      
 174   3                  // =================================================================
 175   3                  // è‡ªåŠ¨æ¨¡å¼ ï¼Œä¹Ÿæ˜¯å°é¥æ§å™¨çš„æ•°å­—5                                   //
 176   3                  // =================================================================
 177   3              case IR_KEY_AUTO_OR_NUM_5:
 178   3      
 179   3                  set_led_mode_status(CUR_LED_MODE_INITIAL_DISCHARGE_GEAR_IN_SETTING_MODE, 5);
 180   3      
 181   3                  // å¦‚æœä¸åœ¨è®¾ç½®æ¨¡å¼ å¹¶ä¸” ä¸åœ¨ æŒ‡ç¤ºæ¨¡å¼ï¼Œæ‰è°ƒèŠ‚
 182   3                  if (0 == flag_is_in_setting_mode &&
 183   3                      0 == flag_is_in_struction_mode &&
 184   3                      CUR_LED_MODE_OFF != cur_led_mode) /* æœªå…³æœº */
 185   3                  {
 186   4                      flag_is_auto_shutdown_enable = 0; // å…³é—­å®šæ—¶å…³æœºçš„åŠŸèƒ½
 187   4      
 188   4                      // ç›´æ¥è®¾ç½®ä¸ºå½“å‰åˆå§‹æŒ¡ä½å¯¹åº”çš„äº®åº¦ï¼š
 189   4                      cur_light_pwm_duty_val = light_pwm_duty_init_val_table[cur_initial_discharge_gear - 1];
 190   4                      // æ¸…ç©ºè°ƒèŠ‚æ—¶é—´è®¡æ—¶å€¼ï¼š
 191   4                      light_adjust_time_cnt = 0;
 192   4                      LIGHT_SET_PWM_DUTY(cur_light_pwm_duty_val);
 193   4                      light_blink(3);
 194   4                  }
 195   3      
 196   3                  flag_is_adjust_light_slowly = 0; // å…³é—­ç¼“æ…¢è°ƒèŠ‚ä¸»ç¯å…‰çš„æ“ä½œ
 197   3      
 198   3                  break;
 199   3      
 200   3                  // =================================================================
 201   3                  // 5Hï¼Œä¹Ÿæ˜¯å°é¥æ§å™¨çš„M1                                             //
 202   3                  // =================================================================
 203   3              case IR_KEY_5H_OR_M1:
 204   3                  // TODOï¼šå¾…å®Œå–„åŠŸèƒ½
 205   3      
 206   3                  set_led_mode_status(CUR_LED_MODE_DISCHARGE_RATE_IN_SETTING_MODE, 1);
 207   3      
 208   3                  // å¦‚æœä¸åœ¨è®¾ç½®æ¨¡å¼ å¹¶ä¸” ä¸åœ¨ æŒ‡ç¤ºæ¨¡å¼ï¼Œæ‰è°ƒèŠ‚
 209   3                  // if (0 == flag_is_in_setting_mode && 0 == flag_is_in_struction_mode)
 210   3                  if (0 == flag_is_in_setting_mode &&   /* ä¸åœ¨è®¾ç½®æ¨¡å¼ */
 211   3                      0 == flag_is_in_struction_mode && /* ä¸åœ¨æŒ‡ç¤ºæ¨¡å¼ */
 212   3                      CUR_LED_MODE_OFF != cur_led_mode) /* æœªå…³æœº */
 213   3                  {
 214   4                      // ç›´æ¥è®¾ç½®ä¸ºå½“å‰åˆå§‹æŒ¡ä½å¯¹åº”çš„äº®åº¦ï¼š
 215   4                      cur_light_pwm_duty_val = light_pwm_duty_init_val_table[cur_initial_discharge_gear - 1];
 216   4                      // light_auto_shutdown_time_cnt = (u32)5 * 60 * 60 * 1000; // 5 å°æ—¶
 217   4                      light_auto_shutdown_time_cnt = (u32)5 * 1000; // 5 sï¼Œæµ‹è¯•æ—¶ä½¿ç”¨
 218   4                      flag_is_auto_shutdown_enable = 1;
 219   4                      light_blink(3);
 220   4                      // printf("5H press\n");
 221   4                  }
 222   3      
 223   3                  flag_is_adjust_light_slowly = 0; // å…³é—­ç¼“æ…¢è°ƒèŠ‚ä¸»ç¯å…‰çš„æ“ä½œ
 224   3      
 225   3                  break;
 226   3      
 227   3                  // =================================================================
 228   3                  // å°é¥æ§å™¨çš„M2                                                    //
 229   3                  // =================================================================
 230   3              case IR_KEY_M2:
 231   3      
 232   3                  set_led_mode_status(CUR_LED_MODE_DISCHARGE_RATE_IN_SETTING_MODE, 2);
 233   3      
C51 COMPILER V9.60.7.0   IR_HANDLE                                                         08/11/2025 14:25:49 PAGE 5   

 234   3                  flag_is_adjust_light_slowly = 0; // å…³é—­ç¼“æ…¢è°ƒèŠ‚ä¸»ç¯å…‰çš„æ“ä½œ
 235   3      
 236   3                  break;
 237   3      
 238   3              case IR_KEY_8H_OR_M3:
 239   3                  // 8Hï¼Œä¹Ÿæ˜¯å°é¥æ§å™¨çš„M3
 240   3      
 241   3                  set_led_mode_status(CUR_LED_MODE_DISCHARGE_RATE_IN_SETTING_MODE, 3);
 242   3      
 243   3                  // å¦‚æœä¸åœ¨è®¾ç½®æ¨¡å¼ å¹¶ä¸” ä¸åœ¨ æŒ‡ç¤ºæ¨¡å¼ï¼Œæ‰è°ƒèŠ‚
 244   3                  // if (0 == flag_is_in_setting_mode && 0 == flag_is_in_struction_mode)
 245   3                  if (0 == flag_is_in_setting_mode &&   /* ä¸åœ¨è®¾ç½®æ¨¡å¼ */
 246   3                      0 == flag_is_in_struction_mode && /* ä¸åœ¨æŒ‡ç¤ºæ¨¡å¼ */
 247   3                      CUR_LED_MODE_OFF != cur_led_mode) /* æœªå…³æœº */
 248   3                  {
 249   4                      // ç›´æ¥è®¾ç½®ä¸ºå½“å‰åˆå§‹æŒ¡ä½å¯¹åº”çš„äº®åº¦ï¼š
 250   4                      cur_light_pwm_duty_val = light_pwm_duty_init_val_table[cur_initial_discharge_gear - 1];
 251   4                      // light_auto_shutdown_time_cnt = (u32)8 * 60 * 60 * 1000; // 8 å°æ—¶
 252   4                      light_auto_shutdown_time_cnt = (u32)8 * 1000; // 8 sï¼Œæµ‹è¯•æ—¶ä½¿ç”¨
 253   4                      flag_is_auto_shutdown_enable = 1;
 254   4                      light_blink(3);
 255   4                      // printf("8H press\n");
 256   4                  }
 257   3      
 258   3                  flag_is_adjust_light_slowly = 0; // å…³é—­ç¼“æ…¢è°ƒèŠ‚ä¸»ç¯å…‰çš„æ“ä½œ
 259   3      
 260   3                  break;
 261   3      
 262   3                  // =================================================================
 263   3                  // SET æ¨¡å¼è®¾ç½®                                                    //
 264   3                  // =================================================================
 265   3              case IR_KEY_SET:
 266   3      
 267   3                  flag_is_adjust_light_slowly = 0; // å…³é—­ç¼“æ…¢è°ƒèŠ‚ä¸»ç¯å…‰çš„æ“ä½œ
 268   3      
 269   3                  if (flag_is_in_setting_mode)
 270   3                  {
 271   4                  }
 272   3                  else // ä¸å¤„äºè®¾ç½®æ¨¡å¼ä¸‹ï¼Œæ‰è¿›å…¥
 273   3                  {
 274   4                      led_status_clear();
 275   4      
 276   4                      if (CUR_LED_MODE_OFF == cur_led_mode)
 277   4                      {
 278   5                          // å¦‚æœä¹‹å‰æŒ‡ç¤ºç¯æ˜¯å…³é—­çš„
 279   5                          flag_allow_light_in_setting_mode = 1; // ä¸»ç¯å…‰é—ªçƒå®Œæˆåï¼Œç«‹å³å…³ç¯
 280   5                          flag_is_led_off_enable = 1;           // è®¾ç½®æ¨¡å¼é€€å‡ºåï¼Œå…³é—­ledæŒ‡ç¤ºç¯
 281   5      
 282   5                          /*
 283   5                              å¦‚æœä»å…³ç¯è¿›å…¥è®¾ç½®æ¨¡å¼ï¼Œç¯å…‰äº®åº¦è¦å›åˆ°å½“å‰æŒ¡ä½å¯¹åº”çš„åˆå
             -§‹äº®åº¦
 284   5                          */
 285   5                          cur_light_pwm_duty_val = light_pwm_duty_init_val_table[cur_initial_discharge_gear - 1]
             -;
 286   5                      }
 287   4      
 288   4                      cur_led_mode = CUR_LED_MODE_SETTING;
 289   4                      flag_is_in_setting_mode = 1;             // è¡¨ç¤ºè¿›å…¥è®¾ç½®æ¨¡å¼
 290   4                      light_blink(cur_initial_discharge_gear); // ç¬¬ä¸€æ¬¡è¿›å…¥è®¾ç½®æ¨¡å¼ï¼Œä¸»ç¯å…‰é—ªçƒï
             -¼Œé—ªçƒæ¬¡æ•°å¯¹åº”åˆå§‹æ”¾ç”µæ¡£ä½
 291   4                  }
 292   3      
C51 COMPILER V9.60.7.0   IR_HANDLE                                                         08/11/2025 14:25:49 PAGE 6   

 293   3                  break;
 294   3      
 295   3                  // =================================================================
 296   3                  // å¼€ç¯                                                          //
 297   3                  // =================================================================
 298   3              case IR_KEY_ON:
 299   3      
 300   3                  // if (flag_is_in_setting_mode || flag_is_in_struction_mode)
 301   3                  // {
 302   3                  //     // å¦‚æœåœ¨è®¾ç½®æˆ–æŒ‡ç¤ºæ¨¡å¼ï¼Œä¸å¤„ç†ONæŒ‰é”®
 303   3                  //     return;
 304   3                  // }
 305   3      
 306   3                  if (0 == flag_is_in_setting_mode && /* ä¸åœ¨è®¾ç½®æ¨¡å¼ */
 307   3                      0 == flag_is_in_struction_mode) /* ä¸åœ¨æŒ‡ç¤ºæ¨¡å¼ */
 308   3                  {
 309   4                      flag_is_auto_shutdown_enable = 0; // å…³é—­å®šæ—¶å…³æœºçš„åŠŸèƒ½
 310   4      
 311   4                      led_status_clear();
 312   4                      flag_is_led_off_enable = 0;
 313   4                      cur_led_mode = CUR_LED_MODE_BAT_INDICATOR;
 314   4      
 315   4                      flag_is_adjust_light_slowly = 0; // å…³é—­ç¼“æ…¢è°ƒèŠ‚ä¸»ç¯å…‰çš„æ“ä½œ
 316   4      
 317   4                      light_init();
 318   4                  }
 319   3      
 320   3                  break;
 321   3      
 322   3                  // =================================================================
 323   3                  // OFF å…³ç¯                                                       //
 324   3                  // =================================================================
 325   3              case IR_KEY_OFF:
 326   3      
 327   3                  // if ((flag_is_in_setting_mode || flag_is_in_struction_mode) || /* å¦‚æœåœ¨è®¾ç½®æˆ–æŒ‡ç¤ºæ¨
             -¡å¼ */
 328   3                  //     CUR_LED_MODE_OFF == cur_led_mode)                         /* å·²ç»å…³æœº */
 329   3                  // {
 330   3                  //     // ä¸å¤„ç†OFFæŒ‰é”®
 331   3                  //     return;
 332   3                  // }
 333   3      
 334   3                  if (0 == flag_is_in_setting_mode &&   /* ä¸åœ¨è®¾ç½®æ¨¡å¼ */
 335   3                      0 == flag_is_in_struction_mode && /* ä¸åœ¨æŒ‡ç¤ºæ¨¡å¼ */
 336   3                      CUR_LED_MODE_OFF != cur_led_mode) /* æœªå…³æœº */
 337   3                  {
 338   4                      // è¿™é‡Œä¸èƒ½ç›´æ¥å¥—ç”¨ power_off() å‡½æ•°ï¼Œæ ·æœºçš„é¥æ§å™¨æŒ‰ä¸‹offåï¼Œè¿˜éœ€è¦
             -é—ªçƒä¸»ç¯å…‰
 339   4                      flag_is_adjust_light_slowly = 0;  // å…³é—­ç¼“æ…¢è°ƒèŠ‚ä¸»ç¯å…‰çš„æ“ä½œ
 340   4                      flag_is_auto_shutdown_enable = 0; // å…³é—­å®šæ—¶å…³æœºçš„åŠŸèƒ½
 341   4      
 342   4                      /* å¦‚æœç¯å…‰è¿˜æ˜¯äº®çš„ */
 343   4                      /* å½“å‰æœªåœ¨å……ç”µ */
 344   4                      if (cur_light_pwm_duty_val > 0)
 345   4                      {
 346   5                          led_status_clear();
 347   5                          cur_led_mode = CUR_LED_MODE_OFF;
 348   5                          light_blink(2);
 349   5                          cur_light_pwm_duty_val = 0; //
 350   5                      }
 351   4                  }
 352   3      
C51 COMPILER V9.60.7.0   IR_HANDLE                                                         08/11/2025 14:25:49 PAGE 7   

 353   3                  break;
 354   3      
 355   3                  // =================================================================
 356   3                  // å…¨äº®                                                           //
 357   3                  // =================================================================
 358   3              case IR_KEY_FULL_BRIGHTNESS:
 359   3      
 360   3                  if (0 == flag_is_in_setting_mode &&   /* ä¸åœ¨è®¾ç½®æ¨¡å¼ */
 361   3                      0 == flag_is_in_struction_mode && /* ä¸åœ¨æŒ‡ç¤ºæ¨¡å¼ */
 362   3                      CUR_LED_MODE_OFF != cur_led_mode) /* æœªå…³æœº */
 363   3                  {
 364   4                      flag_is_adjust_light_slowly = 0; // å…³é—­ç¼“æ…¢è°ƒèŠ‚ä¸»ç¯å…‰çš„æ“ä½œ
 365   4      
 366   4                      // ç›´æ¥è®¾ç½®ä¸ºå½“å‰åˆå§‹æŒ¡ä½å¯¹åº”çš„äº®åº¦ï¼š
 367   4                      cur_light_pwm_duty_val = light_pwm_duty_init_val_table[cur_initial_discharge_gear - 1];
 368   4      
 369   4                      light_blink(3);
 370   4                  }
 371   3      
 372   3                  break;
 373   3      
 374   3                  // =================================================================
 375   3                  // åŠäº®                                                           //
 376   3                  // =================================================================
 377   3              case IR_KEY_HALF_BRIGHTNESS:
 378   3      
 379   3                  if (0 == flag_is_in_setting_mode &&   /* ä¸åœ¨è®¾ç½®æ¨¡å¼ */
 380   3                      0 == flag_is_in_struction_mode && /* ä¸åœ¨æŒ‡ç¤ºæ¨¡å¼ */
 381   3                      CUR_LED_MODE_OFF != cur_led_mode) /* æœªå…³æœº */
 382   3                  {
 383   4                      flag_is_adjust_light_slowly = 0; // å…³é—­ç¼“æ…¢è°ƒèŠ‚ä¸»ç¯å…‰çš„æ“ä½œ
 384   4      
 385   4                      // è®¾ç½®ä¸ºå½“å‰åˆå§‹æŒ¡ä½äº®åº¦å€¼çš„ä¸€åŠ
 386   4                      cur_light_pwm_duty_val = light_pwm_duty_init_val_table[cur_initial_discharge_gear - 1] / 2
             -;
 387   4      
 388   4                      light_blink(3);
 389   4                  }
 390   3      
 391   3                  break;
 392   3              } // switch (ir_data)
 393   2          } // if (flag_is_recved_data)
 394   1      
 395   1          // æ”¶åˆ°é‡å¤ç 
 396   1          if (flag_is_recv_ir_repeat_code)
 397   1          {
 398   2              flag_is_recv_ir_repeat_code = 0;
 399   2      
 400   2              /* å¦‚æœç¯å…‰è¿˜æ˜¯äº®çš„ */
 401   2              /* å½“å‰æœªåœ¨å……ç”µ */
 402   2              if (cur_light_pwm_duty_val > 0)
 403   2              {
 404   3                  expect_light_pwm_duty_val = cur_light_pwm_duty_val; // è·å–ä¸€æ¬¡å½“å‰ä¸»ç¯å…‰çš„äº®åº¦å€¼
 405   3      
 406   3                  if (IR_KEY_BRIGHTNESS_ADD_OR_NUM_4 == last_ir_data)
 407   3                  {
 408   4                      // äº®åº¦åŠ  æ¯æ¬¡å˜åŒ– 2.59%
 409   4                      if (cur_light_pwm_duty_val <
 410   4                          (light_pwm_duty_init_val_table[cur_initial_discharge_gear - 1] -
 411   4                           (u16)((u32)TIMER2_FEQ * 259 / 10000))) /* å½“å‰äº®åº¦å€¼å°äºåˆå§‹äº®åº¦å€¼å‡å» 
             -2.59% */
 412   4                      {
C51 COMPILER V9.60.7.0   IR_HANDLE                                                         08/11/2025 14:25:49 PAGE 8   

 413   5                          expect_light_pwm_duty_val += (u16)((u32)TIMER2_FEQ * 259 / 10000);
 414   5                      }
 415   4                      else
 416   4                      {
 417   5                          /*
 418   5                              å½“å‰äº®åº¦å€¼ä¸å°äºåˆå§‹äº®åº¦å€¼å‡å» 2.59%ï¼Œç›´æ¥å˜ä¸ºåˆå§‹äº®åº¦å€¼
 419   5                          */
 420   5                          expect_light_pwm_duty_val = light_pwm_duty_init_val_table[cur_initial_discharge_gear -
             - 1];
 421   5                      }
 422   4      
 423   4                      // LIGHT_SET_PWM_DUTY(cur_light_pwm_duty_val); // è¿™ä¸ªæ“ä½œåº”è¯¥å¯ä»¥ç»Ÿä¸€æ”¾åˆ°ä¸»å
             -‡½æ•°ä¸­æ¥æ›´æ–°
 424   4                      flag_is_adjust_light_slowly = 1; // è®©å®šæ—¶å™¨ç¼“æ…¢è°ƒèŠ‚å ç©ºæ¯”
 425   4                  }
 426   3                  else if (IR_KEY_BRIGHTNESS_SUB_OR_NUM_2 == last_ir_data)
 427   3                  {
 428   4                      // äº®åº¦å‡ æ¯æ¬¡å˜åŒ– 2.59%
 429   4                      if (cur_light_pwm_duty_val >
 430   4                          (light_pwm_sub_table[ARRAY_SIZE(light_pwm_sub_table) - 1] +
 431   4                           (u16)((u32)TIMER2_FEQ * 259 / 10000))) /* å½“å‰äº®åº¦å€¼å¤§äºæœ€å°äº®åº¦å€¼åŠ  2.5
             -9% */
 432   4                      {
 433   5                          expect_light_pwm_duty_val -= (u16)((u32)TIMER2_FEQ * 259 / 10000);
 434   5                      }
 435   4                      else
 436   4                      {
 437   5                          /*
 438   5                              å½“å‰äº®åº¦å€¼ä¸å¤§äºæœ€å°äº®åº¦å€¼åŠ  2.59%ï¼Œç›´æ¥å˜ä¸ºæœ€å°äº®åº¦å€¼
 439   5                          */
 440   5                          expect_light_pwm_duty_val = light_pwm_sub_table[ARRAY_SIZE(light_pwm_sub_table) - 1];
 441   5                      }
 442   4      
 443   4                      // LIGHT_SET_PWM_DUTY(cur_light_pwm_duty_val); // è¿™ä¸ªæ“ä½œåº”è¯¥å¯ä»¥ç»Ÿä¸€æ”¾åˆ°ä¸»å
             -‡½æ•°ä¸­æ¥æ›´æ–°
 444   4                      flag_is_adjust_light_slowly = 1; // è®©å®šæ—¶å™¨ç¼“æ…¢è°ƒèŠ‚å ç©ºæ¯”
 445   4                  }
 446   3              }
 447   2          }
 448   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   1159    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =      1       1
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
